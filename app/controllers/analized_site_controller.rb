# frozen_string_literal: true

class AnalizedSiteController < ApplicationController
  def index; end
  AnalyzedSite = Struct.new(:flaws_found, :vulnerabilities, :flaws, :analysis)
  def show
    analysisId = params[:id]
    analysis = Analysis.find(analysisId)

    if analysis.is_scan_completed == 0
      redirect_back fallback_location: dashboard_index_path
    end
    flawsFound = SecurityFlaw.where(analyses_id: analysisId).count
    vulnerabilities = Vulnerability.joins('INNER JOIN security_flaws ON security_flaws.vulnerability_id = vulnerabilities.id AND security_flaws.analyses_id = ' + analysisId).order(:id)
    flaws = SecurityFlaw.where(analyses_id: analysisId).order(:vulnerability_id)
    @analyzed_site = AnalyzedSite.new(flawsFound, vulnerabilities, flaws, analysis)
  end

  def new; end
end
