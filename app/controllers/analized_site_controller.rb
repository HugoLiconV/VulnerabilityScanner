# frozen_string_literal: true

class AnalizedSiteController < ApplicationController
  def index; end
  AnalyzedSite = Struct.new(:flaws_found, :vulnerabilities, :flaws, :analysis)
  def show
    analysis_id = params[:id]
    analysis = Analysis.find(analysis_id)

    if analysis.is_scan_completed == 0
      redirect_back fallback_location: dashboard_path
    end
    flaws_found = SecurityFlaw.security_flaws_count(analysis_id)
    vulnerabilities = Vulnerability.joins('INNER JOIN security_flaws ON security_flaws.vulnerability_id = vulnerabilities.id AND security_flaws.analyses_id = ' + analysis_id).order(:id)
    # flaws = SecurityFlaw.where(analyses_id: analysisId).order(:vulnerability_id)
    flaws = SecurityFlaw.find_by_analysis_id(analysis_id, :vulnerability_id)
    @analyzed_site = AnalyzedSite.new(flaws_found, vulnerabilities, flaws, analysis)
  end

  def new; end
end
