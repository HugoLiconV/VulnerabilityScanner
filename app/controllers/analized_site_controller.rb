# frozen_string_literal: true

class AnalizedSiteController < ApplicationController
  def index; end
  AnalyzedSite = Struct.new(:flaws_found, :vulnerabilities, :flaws, :analysis)
  def show
    analysis_id = params[:id]
    analysis = Analysis.find(analysis_id)

    if analysis.is_scan_completed == 0
      redirect_back fallback_location: dashboard_path
    end
    flaws_found = SecurityFlaw.security_flaws_count(analysis_id)
    vulnerabilities = Vulnerability.get_vulnerability_flaws(analysis_id)
    flaws = SecurityFlaw.find_by_analysis_id(analysis_id).order(:vulnerability_id)
    @analyzed_site = AnalyzedSite.new(flaws_found, vulnerabilities, flaws, analysis)
  end

  def new; end
end
