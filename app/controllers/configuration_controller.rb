include BCrypt

class ConfigurationController < ApplicationController


  def show
  end

  def edit
    @user = User.find(params[:id])
  end

  def update
    @user = User.find(params[:id])

    post_params = params.require(:user).permit(:email, :encrypted_password)

    password = Password.create(post_params[:encrypted_password])

    @user.update(email: post_params[:email], encrypted_password: password)

    redirect_to home_path
  end


  def destroy

    @user = User.find(params[:id])

    @analyses = Analysis.find_by_user_id(@user.id)

    @analyses.each do |analysis|
      @analysisTestsVulnerabilities = AnalysisTestsVulnerability.where("analyses_id = #{analysis.id}")
      if @analysisTestsVulnerabilities[0]
        @analysisTestsVulnerabilities.destroy
      end
      @flaw = SecurityFlaw.find_by_analysis_id(analysis.id)
      if @flaw[0]
        @flaw.destroy
      end
      analysis.destroy
    end

    @user.destroy

    redirect_to home_path

  end


end
