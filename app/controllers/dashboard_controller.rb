class DashboardController < ApplicationController
	before_action :authenticate_user!

  # TODO Add scopes
  # TODO Change variables names
  # TODO Use struct
  def index
    @currentUser = current_user.id
    @analyses = Analysis.all.where(user_id: @currentUser).order(analysis_date: :desc)
    @numberOfAnalysis = Analysis.number_of_analysis
    @numberOfAnalysisCompleted = Analysis.where(user_id: @currentUser).where(is_scan_completed: 1).count
    @numberOfAnalysisPending = Analysis.where(user_id: @currentUser).where(is_scan_completed: 0).count
    @detectedFlaws = Analysis.joins("INNER JOIN security_flaws ON security_flaws.analyses_id = analyses.id AND analyses.user_id = #{@currentUser}").count

    # @typeOfFlaws = Analysis.joins("INNER JOIN security_flaws ON security_flaws.analyses_id = analyses.id AND analyses.user_id = 1 ORDER BY vulnerability_id ASC;")

    @typeOfFlaws = SecurityFlaw.joins("INNER JOIN analyses ON analyses.id = security_flaws.analyses_id AND analyses.user_id = #{@currentUser}")

    @numberOfFlawsType = [0,0,0,0,0,0,0,0,0,0]

    @typeOfFlaws.each do |typeOfFlaw|

      @numberOfFlawsType[typeOfFlaw.vulnerability_id-1] = @numberOfFlawsType[typeOfFlaw.vulnerability_id-1]+1

    end

  end




end
