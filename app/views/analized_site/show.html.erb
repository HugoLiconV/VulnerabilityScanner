<%= render "layouts/app_header.html.erb" %>
<script>
    function showCard(element) {
        $(".info").fadeOut(function () {
            setTimeout(function(){ $("#card"+element.id).fadeIn(); }, 500);
        });
    };
</script>
<div class="row">
  <div class="col s10 offset-s1">
    <div class="row">
      <div class="col s1">
        <%= link_to raw('<i class="material-icons">arrow_back</i>'), dashboard_index_path, class: 'btn-floating btn-small waves-effect waves-light deep-orange darken-2' %>
      </div>
      <div class="col s7 offset-s2">
        <h4><%= @analysis.url + " - " %><%= @analysis.analysis_date.strftime("%d") + '/' + @analysis.analysis_date.strftime("%m") + '/' + @analysis.analysis_date.strftime("%Y") %></h4>
      </div>
      <div class="col s2">
        <%= link_to raw('<i class="material-icons">picture_as_pdf</i>'), dashboard_index_path, class: 'btn-floating btn-small waves-effect waves-light deep-orange darken-2' %>
        <%= link_to raw('<i class="material-icons">text_fields</i>'), dashboard_index_path, class: 'btn-floating btn-small waves-effect waves-light deep-orange darken-2' %>
        <%= link_to raw('<i class="material-icons">code</i>'), dashboard_index_path, class: 'btn-floating btn-small waves-effect waves-light deep-orange darken-2' %>
      </div>
    </div>
    <div class="row">
      <div class="col s4">
        <div class="card">
          <div class="card-content white-text">
            <span class="card-title black-text">Flaws Found - <%= @flawsFound %></span>
            <ul class="collection">
              <% @vulnerabilities.each do |vulnerability| %>
                <li id="<%= vulnerability.id %>" class="item collection-item black-text" onclick="showCard(this)"><div><%= vulnerability.name %><a href="#!" class="secondary-content"><i class="material-icons">remove_red_eye</i></a></div></li>
              <% end %>
            </ul>
          </div>
        </div>
      </div>
      <% @flaws.each_with_index do |flaw, index| %>
          <div id="card<%= flaw.vulnerability_id %>" class="info col s8" <%= index>0 ? 'hidden': '' %>>
            <div class="card">
              <div class="card-content white-text">
                <span class="card-title black-text"><%= @vulnerabilities[index].name %></span>
                <p><strong>Description: </strong> <%= raw @vulnerabilities[index].description %> </p>
                <p><strong>How to prevent it: </strong></p>
                <%= raw @vulnerabilities[index].prevention %>
              </div>
            </div>
          </div>
      <% end %>

    </div>
  </div>
</div>
